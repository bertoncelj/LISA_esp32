<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="light_style.css">
<title>Iskra iHUB Lite</title>
</head>
<body>
<table id="t01">
<tbody>
<tr style="font-weight: bold; font-size: 200%; font-family: Verdana;text-align: center;">
<td> <img src="iskra_logo1.jpg" alt="Iskra"></td>
<td></td>
<td>Статус iHUB</td>
</tr>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
<tr style="height: 10px;"><td></td></tr>
<tr>
<td valign="top">
<div class="vertical-menu">
  <a href="/index.html" class="active">Статус iHUB</a>
  <a href="/settings_general.html">Настройки iHUB</a>
  <a href="/rs485_devices.html">Устройства RS485</a>
  <a href="/wifi_devices.html">Устройства Wifi</a>   
  <a href="/counters.html">Счетчики</a>  
  <a href="/measurements.html">Измерения</a>
  <a href="/graph.html">График мощности</a>
  <a href="/demands.html">Макс. значения</a>
  <a href="/settings.html">Настройки устройства</a>  
  <a href="/bicom.html">Управление Bicom</a>
  <!--<a href="/edit">File Browser</a> -->
  <a href="/update">Обновление</a>
</div>
</td>
<td></td>
<td valign="top">
<table id="t02">
<tr>
<th>Общее</th>
<th></th>
</tr>
<tr>
<td class="t02Cell">Тип устройства</td>
<td class="t02Cell"><span id="device_type"></span></td>
</tr>
<tr>
<td class="t02Cell">Серийный номер</td>
<td class="t02Cell"><span id="serial"></span></td>
</tr>
<tr>
<td class="t02Cell">Описание</td>
<td><span id="description"></span></td>
</tr>
<tr>
<td class="t02Cell">Местонахождение</td>
<td><span id="location"></span></td>
</tr>
<tr>
<th>Статус WiFi</th>
<th></th>
</tr>
<tr>
<td class="t02Cell">WiFi SSID</td>
<td><span id="ssid"></span></td>
</tr>
<tr>
<td class="t02Cell">IP адрес</td>
<td class="t02Cell"><span id="ip_address"></span></td>
</tr>
<tr>
<td class="t02Cell">MAC адрес</td>
<td class="t02Cell"><span id="mac_address"></span></td>
</tr>
<tr>
<td class="t02Cell">Уровень сигнала WiFi</td>
<td class="t02Cell"><span id="wifi_signal_level"></span></td>
</tr>
<tr>
<td class="t02Cell">Время работы WiFi</td>
<td class="t02Cell"><span id="uptime"></span></td>
</tr>
<tr>
<th>Статус CPU</th>
<th></th>
</tr>
<tr>
<td class="t02Cell">Режим процессора</td>
<td class="t02Cell"><span id="cpu_mode"></span></td>
</tr>
<tr>
<td class="t02Cell">Адрес iHUB Modbus </td>
<td class="t02Cell">#<span id="ihub_modbus_addr"></span></td>
</tr>
<tr>
<td class="t02Cell">Время работы процессора</td>
<td class="t02Cell"><span id="cpu_uptime"></span></td>
</tr>
<tr>
<th>Инофрмация о версии</th>
<th></th>
</tr>
<tr>
<td class="t02Cell">Версия ПО WiFi</td>
<td class="t02Cell"><span id="sw_version"></span></td>
</tr>
<tr>
<td class="t02Cell">Версия ПО процессора</td>
<td class="t02Cell"><span id="version"></span></td>
</tr>
<tr>
<td class="t02Cell">Версия файловой системы</td>
<td class="t02Cell"><span id="fs_ver"></span></td>
</tr>
<tr>
<td class="t02Cell">Версия загрузчика</td>
<td class="t02Cell"><span id="bootloader_ver"></span></td>
</tr>
<tr>
<td class="t02Cell">Версия аппаратного обеспечения</td>
<td class="t02Cell"><span id="hw_ver"></span></td>
</tr>
<tr>
<th>Обнаруженные устройства</th>
<th></th>
</tr>
<tr>
<td class="t02Cell">Левое ИК-устройство</td>
<td class="t02Cell"><span id="left_ir_type"></span></td>
</tr>
<tr>
<td class="t02Cell">Правое ИК-устройство</td>
<td class="t02Cell"><span id="right_ir_type"></span></td>
</tr>
<tr>
<td class="t02Cell">RS 485 Устройство 1</td>
<td class="t02Cell"><span id="rs485_1_type"></span></td>
</tr>
<tr>
<td class="t02Cell">RS 485 Устройство 2</td>
<td class="t02Cell"><span id="rs485_2_type"></span></td>
</tr>
<tr>
<th>Bicoms</th>
<th></th>
</tr>
<tr>
<td class="t02Cell"><span id="ir_relay_description"></span> Статус</td>
<td class="t02Cell"><span id="bicom_state"></span></td>
</tr>
<tr>
<td class="t02Cell"><span id="rs485_description_1"></span> Статус</td>
<td class="t02Cell"><span id="bicom_485_1_state"></span></td>
</tr>
<tr>
<td class="t02Cell"><span id="rs485_description_2"></span> Статус</td>
<td class="t02Cell"><span id="bicom_485_2_state"></span></td>
</tr>
<tr>
<th>Другое</th>
<th></th>
</tr>
<tr>
<td class="t02Cell">Температура</td>
<td class="t02Cell"><span id="pt_1000_temp"></span> &#176;C</td>
</tr>
<tr>
<td class="t02Cell">Состояние цифрового входа</td>
<td class="t02Cell"><span id="dig_in_state"></span></td>
</tr>
<tr>
<td class="t02Cell">Время</td>
<td class="t02Cell"><span id="timestamp"></span></td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<script type="text/javascript">
      function updateData() {
        console.log("updateData()");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
           console.log("updateData(): got Data:", this.responseText);
           var measData = JSON.parse(this.responseText);           
           document.getElementById("device_type").innerHTML = measData.device_type;
           document.getElementById("serial").innerHTML = measData.serial;
           document.getElementById("ssid").innerHTML = measData.ssid;
           document.getElementById("ip_address").innerHTML = measData.ip_address;
           document.getElementById("mac_address").innerHTML = measData.mac_address; 
           document.getElementById("wifi_signal_level").innerHTML = measData.wifi_signal_level;          
           document.getElementById("sw_version").innerHTML = measData.sw_version;           
           document.getElementById("fs_ver").innerHTML = measData.fs_ver;
           document.getElementById("description").innerHTML = measData.description;
           document.getElementById("location").innerHTML = measData.location;                                           
           document.getElementById("uptime").innerHTML = measData.uptime;
           if(measData.cpu_mode == "0")
            document.getElementById("cpu_mode").innerHTML ="Загрузчик";
           else 
             document.getElementById("cpu_mode").innerHTML ="Приложение";
           //document.getElementById("cpu_mode").innerHTML = measData.cpu_mode;
           document.getElementById("timestamp").innerHTML = measData.timestamp;
          }
        };
        xhttp.open("GET", "/wifi_data?_=" + new Date().getTime(), true);//add timestamp to avoid browser caching
        xhttp.send();
      }
      
      function updateCpuData() {
        console.log("updateCpuData()");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
           var bicom_states = ["Недоступен", "Вкл.", "Выкл."]; //n/a,on, off
           console.log("updateCpuData(): got Data:", this.responseText);
           var measData = JSON.parse(this.responseText);           
           document.getElementById("ihub_modbus_addr").innerHTML = measData.ihub_modbus_addr;
           document.getElementById("version").innerHTML = measData.version;
           document.getElementById("bootloader_ver").innerHTML = measData.bootloader_ver; 
           document.getElementById("hw_ver").innerHTML = measData.hw_ver;
           //document.getElementById("spi_flash").innerHTML = measData.spi_flash;
           document.getElementById("cpu_uptime").innerHTML = measData.uptime;           
           document.getElementById("left_ir_type").innerHTML = measData.left_ir_type.concat(" #",measData.left_ir_addr);
           document.getElementById("ir_relay_description").innerHTML = measData.ir_relay_description;           
           document.getElementById("right_ir_type").innerHTML = measData.right_ir_type;
           document.getElementById("rs485_1_type").innerHTML = measData.rs485_1_type.concat(" #",measData.rs485_1_addr);           
           document.getElementById("rs485_description_1").innerHTML = measData.rs485_description_1;
           document.getElementById("rs485_2_type").innerHTML = measData.rs485_2_type.concat(" #",measData.rs485_2_addr);           
           document.getElementById("rs485_description_2").innerHTML = measData.rs485_description_2;            
           if(measData.bicom_state == "OFF")
            document.getElementById("bicom_state").innerHTML = bicom_states[2];
           else if(measData.bicom_state == "ON")
            document.getElementById("bicom_state").innerHTML = bicom_states[1];
           else
            document.getElementById("bicom_state").innerHTML = bicom_states[0];
            
           if(measData.bicom_485_1_state == "OFF")
            document.getElementById("bicom_485_1_state").innerHTML = bicom_states[2];
           else if(measData.bicom_485_1_state == "ON")
            document.getElementById("bicom_485_1_state").innerHTML = bicom_states[1];
           else
            document.getElementById("bicom_485_1_state").innerHTML = bicom_states[0];              
            
           if(measData.bicom_485_2_state == "OFF")
            document.getElementById("bicom_485_2_state").innerHTML = bicom_states[2];
           else if(measData.bicom_485_2_state == "ON")
            document.getElementById("bicom_485_2_state").innerHTML = bicom_states[1];
           else
            document.getElementById("bicom_485_2_state").innerHTML = bicom_states[0];            
           
           document.getElementById("pt_1000_temp").innerHTML = measData.pt_1000_temp;
           
           if(measData.dig_in_state == "OFF")
            document.getElementById("dig_in_state").innerHTML =  bicom_states[2];
           else          
             document.getElementById("dig_in_state").innerHTML =  bicom_states[1];
             
           document.getElementById("timestamp").innerHTML = measData.local_time;
          }
        };
        xhttp.open("GET", "/status?_=" + new Date().getTime(), true);//add timestamp to avoid browser caching
        xhttp.send();
      }
      
      updateData();
      window.setInterval(updateData, 60000); //update the counters every 60 seconds
      updateCpuData();
      window.setInterval(updateCpuData, 60000); //update the counters every 60 seconds
    </script>
</body>
</html>
